<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset='UTF-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ESP32 PIR Motion Sensor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .motion-card {
            transition: all 0.3s ease;
        }
        .motion-active {
            background-color: #ffc107;
        }
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
            background-color: #dc3545;
        }
        .status-active {
            background-color: #198754;
        }
        .sound-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="mb-0">PIR Motion Sensor</h2>
                    <div>
                        <span class="status-indicator" id="connection-status"></span>
                        <span id="status-text">Disconnected</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="motion-card card mb-3">
                    <div class="card-body text-center">
                        <h4><i class="bi bi-eye"></i> Motion Status</h4>
                        <p class="display-4" id="motion-status">No Motion</p>
                        <p class="text-muted" id="last-detection">Last detection: Never</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sound-control">
        <button class="btn btn-primary" onclick="toggleSound()" id="soundToggle">
            <i class="bi bi-volume-up-fill"></i> Sound Alerts
        </button>
    </div>

    <audio id="alertSound">
        <source src="beep.mp3" type="audio/mpeg">
    </audio>

    <script>
    let isConnected = false;
    let lastMotionTime = null;
    let soundEnabled = true;

    function toggleSound() {
        soundEnabled = !soundEnabled;
        const button = document.getElementById('soundToggle');
        button.innerHTML = `<i class="bi bi-volume-${soundEnabled ? 'up' : 'mute'}-fill"></i> Sound Alerts`;
    }

    function playAlertSound() {
        if (soundEnabled) {
            const audio = document.getElementById('alertSound');
            audio.currentTime = 0;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }
    }

    function updateConnectionStatus(connected) {
        const statusIndicator = document.getElementById('connection-status');
        const statusText = document.getElementById('status-text');
        
        isConnected = connected;
        statusIndicator.classList.toggle('status-active', connected);
        statusText.textContent = connected ? 'Connected' : 'Disconnected';
    }

    function updateMotionStatus(motion) {
        const motionCard = document.querySelector('.motion-card');
        const motionStatus = document.getElementById('motion-status');
        const lastDetection = document.getElementById('last-detection');

        if (motion) {
            motionCard.classList.add('motion-active');
            motionStatus.textContent = 'Motion Detected';
            lastDetection.textContent = 'Last detection: ' + new Date().toLocaleString();
            playAlertSound(); // Play sound on motion detection
        } else {
            motionCard.classList.remove('motion-active');
            motionStatus.textContent = 'No Motion';
        }
    }

    function simulateMotionDetection() {
        updateConnectionStatus(true);
        setInterval(() => {
            const motionDetected = Math.random() > 0.5;
            updateMotionStatus(motionDetected);
        }, 2000);
    }

    window.onload = () => {
        simulateMotionDetection();
    };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>